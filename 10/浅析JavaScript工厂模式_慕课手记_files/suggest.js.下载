define(function(){var a={create:function(){return function(){this.initialize.apply(this,arguments)}}},c=a.create();return c.prototype={initialize:function(a){var c=this.getDom(a);this.container=a,this.searchBtn=c.searchBtn,this.suggestTrigger=c.suggestTrigger,this.searchWrap=c.searchWrap,this.suggestPanel=c.suggestPanel,this.clearTextBtn=c.clearTextBtn,this.searchHistory=[],this.timer=null,this.currIndex=-1,this.addListener()},createSuggest:function(a){var c=this;this.timer&&clearTimeout(this.timer),this.timer=setTimeout(function(){if(a.length>0)c.getTargetSuggest(a);else{if(!isLogin)return void c.clearSuggest();c.getLatestSuggest()}},200)},getTargetSuggest:function(a){var c=this;$.ajax({type:"get",url:"/search/history?words="+a,dataType:"json",success:function(a){var h=a&&a.data;h&&c.autoComplete(h,1)}})},getLatestSuggest:function(){var a=this;0==this.searchHistory.length?$.ajax({type:"GET",url:"/index/searchhistory",dataType:"json",success:function(c){a.searchHistory=c.data,a.autoComplete(c.data)}}):this.autoComplete(this.searchHistory)},addListener:function(){var a=this;this.suggestTrigger.on({keyup:function(c){switch(a.timer&&clearTimeout(a.timer),c.keyCode){case 38:a.setCurrIndex("up"),a.itemSwitch();break;case 40:a.setCurrIndex("down"),a.itemSwitch();break;case 13:return a.triggerSearch($(this)),!1;default:var h=a.getTriggerValue($(this));a.createSuggest(h),a.setClearTextBtnState(h)}},focus:function(){var c=a.getTriggerValue($(this));a.container.addClass("suggest-active"),a.container.parent().addClass("search-active"),a.createSuggest(c)},blur:function(){a.container.removeClass("suggest-active"),a.container.parent().removeClass("search-active"),setTimeout(function(){a.clearSuggest()},200)}}),this.searchBtn.on("click",function(){var c=a.getTriggerEl($(this));a.triggerSearch(c)}),this.suggestPanel.on({click:function(){a.searchBtn.trigger("click")},mouseover:function(){a.currIndex=$(this).index()},mouseout:function(){a.currIndex=-1}},"li"),this.clearTextBtn.on("click",function(){a.clearSearchText()})},itemSwitch:function(a){var c=this.suggestPanel.find("li"),h=null,g="";c.removeClass("light"),this.currIndex>-1&&(h=c.eq(this.currIndex),h.addClass("light"),g=h.data("key"),this.setTriggerValue(g),this.setClearTextBtnState(g),a&&a())},search:function(a){switch(OP_CONFIG.module){case"wenda":location.href="/search/wenda?words="+encodeURIComponent(a);break;case"article":location.href="/search/article?words="+encodeURIComponent(a);break;case"course":location.href="/search/?type=course&words="+encodeURIComponent(a);break;default:location.href="/search/?words="+encodeURIComponent(a)}},autoComplete:function(a,c){var h=[],g="";if(this.currIndex=-1,a.length){for(var i=0,T=a.length;T>i;i++){var v=this.tpl(a[i]);h.push(v)}g=h.join(""),this.suggestPanel.parent(".history").show(),this.suggestPanel.html(g),c?this.searchWrap.addClass("hot-hide"):this.searchWrap.removeClass("hot-hide")}else this.suggestPanel.parent(".history").hide(),this.suggestPanel.html("");this.searchWrap.slideDown(100)},triggerSearch:function(a){if(this.currIndex>-1){var c=this.suggestPanel.find("li");this.search(c.eq(this.currIndex).data("key"))}else{var h=this.getTriggerValue(a);if(!h)return this.search(""),!1;this.search(h)}},setTriggerValue:function(a){this.suggestTrigger.val(a)},getTriggerValue:function(a){return $.trim(a.val())},getTriggerEl:function(a){return a.closest("[data-search]").find("[data-suggest-trigger]")},setCurrIndex:function(a){var c=this.suggestPanel.find("li"),h=c.length;this.currIndex="up"===a?this.currIndex>-1?this.currIndex-1:h-1:this.currIndex<h-1?this.currIndex+1:-1},setClearTextBtnState:function(a){a?this.clearTextBtn.removeClass("hide"):this.clearTextBtn.addClass("hide")},clearSearchText:function(){this.setTriggerValue(""),this.clearTextBtn.addClass("hide")},clearSuggest:function(){this.searchWrap.slideUp(100),this.suggestPanel.delay(100).html("")},tpl:function(a){return'<li data-key="'+a.word+'">'+a.word+"</li>"},getDom:function(a){return{searchBtn:a.find("[data-search-btn]"),suggestTrigger:a.find("[data-suggest-trigger]"),suggestPanel:a.find("[data-suggest-result]"),clearTextBtn:a.find("[data-clear-btn]"),searchWrap:a.find(".js-search-wrap")}}},c});